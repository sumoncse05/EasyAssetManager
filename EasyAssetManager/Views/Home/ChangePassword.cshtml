
@{
    ViewData["Title"] = "Change Password";
    var appSession = ViewBag.Session as EasyAssetManagerCore.Model.CommonModel.AppSession;
}
<div class="wrapper wrapper-content animated fadeInRight">

    <div class="row">
        <div class="col-lg-12">

            <div class="ibox" id="divsidebarCollapse">
                <div class="ibox-title">
                    <h5>Change Password</h5>
                </div>
                <div class="ibox-content">
                    <form id="formChangePassword" action="#" class="wizard-big">
                        <fieldset>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group row">
                                        <div class="col-xl-2">
                                            <label class="col-form-label">User Name:</label>
                                        </div>
                                        <div class="col-xl-3">
                                            <input type="text" id="user_id" name="user_id" class="form-control form-element" readonly="readonly" value="@appSession.User.user_id" />
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-xl-2">
                                            <label class="col-form-label">Current Password:<span class="required">*</span></label>
                                        </div>
                                        <div class="col-xl-3">
                                            <input type="password" id="Password" name="Password" class="form-control form-element" maxlength="15" />
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-xl-2">
                                            <label class="col-form-label"> New Password:<span class="required">*</span></label>
                                        </div>
                                        <div class="col-xl-3">
                                            <input type="password" id="NewPassword" name="NewPassword" class="form-control form-element" maxlength="15" />
                                        </div>
                                        <div class="col-xl-3">
                                            <div id="password_error">
                                            </div>
                                            <div id="validation_errors_div">
                                                <ul class="validation_errors_ul"></ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-xl-2">
                                            <label class="col-form-label">Confirm New Password:<span class="required"></span></label>
                                        </div>
                                        <div class="col-xl-3">
                                            <input type="password" id="ConfPassword" name="ConfPassword" class="form-control form-element" maxlength="15" />
                                        </div>
                                        <div class="col-xl-3">
                                            <div id="password2_error">
                                            </div>
                                            <div id="validation2_errors_div">
                                                <ul class="validation_errors_ul"></ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col-xl-2">
                                            <label class="col-form-label">Strength:</label>
                                        </div>
                                        <div class="col-xl-3">
                                            <div id="password_strength">
                                                <div style="position: relative; width: 100%; height: 100%">
                                                    <div id="strength_text">
                                                    </div>
                                                    <div id="strength_color">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="text-align:left">
                                            <button type="reset" class="btn btn-primary-outline ks-next">Reset</button>
                                            <input type="button" value="Change Password" class="btn btn-primary ks-next" id="btnChangePassword">
                                        </div>
                                    </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<style>
    #password_strength {
        /*width: 144px;
        height: 20px;*/
        border: 1px solid #BDC7D8;
        margin: 5px 0px 3px 0px;
    }

    #strength_color {
        /*position: absolute;
        left: 0px;
        width: 0%;
        height: 100%;*/
        background-color: #FF0000;
    }

    #strength_text {
        /*position: absolute;
        left: 0px;
        width: 100%;
        height: 100%;
        z-index: 1;
        padding: 0px;
        margin: 0px;*/
        text-align: center;
        font-size: 11px;
    }

    /*#password_error, #password2_error {
        width: 16px;
        height: 16px;
    }

        #password_error img, #password2_error img {
            width: 16px;
            height: 16px;
        }*/

    #validation_errors_div, #validation2_errors_div {
        /*position: absolute;
        left: 290px;*/
        background-color: #FFFFFF;
        border: 1px solid #E56154;
        box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
        /*line-height: 20px;
        margin-left: 5px;
        padding: 0 5px;*/
        display: none;
    }

    /*#validation_errors_div {
        z-index: 99999;
    }

    ##validation2_errors_div {
        z-index: 99998;
    }*/

    ul.validation_errors_ul li.validation_errors_li {
        list-style: none outside none;
        margin: 0;
    }

    .validation_errors_ul {
        margin: 0;
        padding: 2px 5px;
    }

    ul {
        list-style: disc outside none;
    }

        ul li {
            margin: 3px 0 0;
        }
</style>
@section scripts{

    <script type="text/javascript">
        //Repository Change Check In
        var classChangePassword = function ()
        {
            var min_strength = 20; min_length = 6;
            var init = function ()
            {
                eventInitializer();
            };
            var eventInitializer = function ()
            {
                $('#btnChangePassword').click(changePassword);
            };
            var changePassword = function ()
            {
                if (validate_form())
                {
                    var user = ApplicationCommon.getData('form-element');
                    var url = '/Home/ChangePassword';
                    ApplicationCommon.request(url, 'POST', user, false, true, false, function (res)
                    {
                        ApplicationCommon.showNotification(res.messageType, res.messageString);
                        if (res.messageType == 1)
                        {
                             window.location.href = '@Url.Action("Index","Login")';
                        }
                    });
                }

            };

            var GenStrength = function (pwd)
            {
                var nScore = ApplicationCommon.chkPass(pwd);

                /* Determine complexity based on overall score */
                if (nScore > 100) { nScore = 100; } else if (nScore < 0) { nScore = 0; }
                if (nScore >= 0 && nScore < 20) { sComplexity = "Very Weak (" + nScore + "/100)"; sColor = "#FF0000"; }
                else if (nScore >= 20 && nScore < 40) { sComplexity = "Weak (" + nScore + "/100)"; sColor = "#FF9837"; }
                else if (nScore >= 40 && nScore < 60) { sComplexity = "Good (" + nScore + "/100)"; sColor = "#F1FF4D"; }
                else if (nScore >= 60 && nScore < 80) { sComplexity = "Strong (" + nScore + "/100)"; sColor = "#C5FF00"; }
                else if (nScore >= 80 && nScore <= 100) { sComplexity = "Very Strong (" + nScore + "/100)"; sColor = "#8FFF00"; }


                $("#strength_text").html(sComplexity);
                $("#strength_color").css("background-color", sColor);
                $("#strength_color").animate({ "width": +nScore + "%" });


                $('#validation_errors_div').css('top', $("#password_error").position().top);
                $("#validation_errors_div ul").html("");

                if (nScore < min_strength)
                {
                    $("#validation_errors_div ul").append('<li class="validation_errors_li">Minimum Pasword Strength is 20</li>');
                }
                if (pwd.length < min_length)
                {
                    $("#validation_errors_div ul").append('<li class="validation_errors_li">Minimum Pasword Length is 6</li>');
                }

                if (nScore < min_strength || pwd.length < min_length)
                {
                    $("#password_error").html('<img width="16" height="16" align="absmiddle" alt="error" src="/ApplicationTheme/assets/img/error.png">');
                    $("#validation_errors_div").fadeIn("slow");
                }
                else
                {
                    $("#password_error").html('<img width="16" height="16" align="absmiddle" alt="success" src="/ApplicationTheme/assets/img/success.png">');
                    $("#validation_errors_div").hide();
                }
                MatchPass($("#ConfPassword").val());
            };
            var MatchPass = function (pwd)
            {
                if ($("#NewPassword").val() != pwd)
                {
                    $('#validation2_errors_div').css('top', $("#password2_error").position().top);

                    $("#password2_error").html('<img width="16" height="16" align="absmiddle" alt="error" src="/ApplicationTheme/assets/img/error.png">');

                    $("#validation2_errors_div ul").html("");
                    $("#validation2_errors_div ul").append('<li class="validation_errors_li">Password doesn\'t Match!!!</li>');
                    $("#validation2_errors_div").fadeIn("slow");
                }
                else
                {
                    $("#password2_error").html('<img width="16" height="16" align="absmiddle" alt="success" src="/ApplicationTheme/assets/img/success.png">');
                    $("#validation2_errors_div").hide();
                }
            };
            var validate_form = function ()
            {
                GenStrength($("#NewPassword").val());
                MatchPass($("#ConfPassword").val());

                if ($("#user_id").val() == "")
                {
                    ApplicationCommon.showNotification("2", "No user found to change password.");
                    $("#user_id").focus();
                    return false;
                }
                if (ApplicationCommon.chkPass($("#NewPassword").val()) < min_strength)
                {
                    $("#NewPassword").focus();
                    return false;
                }
                if ($("#NewPassword").val().length < min_length)
                {
                    $("#NewPassword").focus();
                    return false;
                }
                if ($("#NewPassword").val() != $("#ConfPassword").val())
                {
                    $("#ConfPassword").focus();
                    return false;
                }

                return true;
            };

            return { init: init };
        }();

        classChangePassword.init();

    </script>
}
